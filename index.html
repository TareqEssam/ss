<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ูุณุงุนุฏ ุงููุฌุงู ุงูุดุงุทุฑ ุฌุฏุง - GAFI AI Assistant</title>
  <link rel="stylesheet" href="css/ai-assistant.css">
  <style>...</style>
</head>
<body>
  ... ูุญุชูู ุงูุตูุญุฉ ...

  <!-- ูุง ูุญููู ุฃู ููุชุจุงุช ููุง -->

  <!-- ุณูุฑูุจุช ูู ููุน module ูุชุญููู ุงูููุชุจุฉ ูุชููุฆุฉ ุงูุชุทุจูู -->
  <script type="module">
    // ุงุณุชูุฑุงุฏ ุงูููุชุจุฉ
    import * as transformers from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0';
    
    // ุชุนุฑูุถ ุงูููุชุจุฉ ุนูู ุงููุงูุฐุฉ ููุงุณุชุฎุฏุงู ูู ูุจู ุงูุณูุฑูุจุชุงุช ุงูุฃุฎุฑู
    window.transformers = transformers;

    // ุงูุขู ูู ุจุงุณุชูุฑุงุฏ ุงููููุงุช ุงูุฃุฎุฑู
    // ููุงุญุธุฉ: ูุฌุจ ุฃู ุชููู ุงููููุงุช ุงูุฃุฎุฑู ูุงุจูุฉ ููุงุณุชูุฑุงุฏ ูู modules
    // ูููููุง ููุณุช ูุฐููุ ูุฐุง ุณูุญุชุงุฌ ุฅูู ุชุญููููุง ูุณูุฑูุจุชุงุช ุนุงุฏูุฉ ุจุนุฏ ุชุญููู ุงูููุชุจุฉ.

    // ุจุฏูุงู ูู ุฐููุ ุณูููู ุจุชุญููููุง ุฏููุงูููููุง ูุณูุฑูุจุชุงุช ุนุงุฏูุฉ
    const scripts = [
      'js/arabic-normalizer.js',
      'js/transformers-loader.js',
      'js/vector-engine-v7.js',
      'js/intent-classifier.js',
      'js/indexeddb-manager.js',
      'js/query-parser.js',
      'js/learning-system.js',
      'js/response-generator.js',
      'js/ai-expert-core.js',
      'js/voice-handler.js',
      'js/typewriter-effect.js',
      'js/ui-controller.js'
    ];

    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = reject;
        document.body.appendChild(script);
      });
    }

    async function loadAll() {
      for (const src of scripts) {
        await loadScript(src);
      }
      // ุจุนุฏ ุชุญููู ุฌููุน ุงูุณูุฑูุจุชุงุชุ ูููู ุจุชููุฆุฉ ุงูุชุทุจูู
      await initializeApp();
    }

    async function initializeApp() {
      console.log('๐ ุจุฏุก ุชุญููู ูุธุงู ุงููุณุงุนุฏ ุงูุฐูู...');

      // ... ููุณ ููุฏ ุงูุชููุฆุฉ ุงูุณุงุจู ...
      // ุณูููู ุจูุณุฎ ููุฏ ุงูุชููุฆุฉ ููุง
      try {
        // === ุงููุฑุญูุฉ 1: ุชุญููู ููุงุนุฏ ุงูุจูุงูุงุช ===
        console.log('๐ฆ ุชุญููู ููุงุนุฏ ุงูุจูุงูุงุช...');
        
        const [activityVectors, decision104Vectors, industrialVectors] = await Promise.all([
          import('./data/activity_vectors.js'),
          import('./data/decision104_vectors.js'),
          import('./data/industrial_vectors.js')
        ]);

        // ุญูุธ ูู window ูููุตูู ุงููุจุงุดุฑ
        window.activityVectors = activityVectors.default;
        window.decision104Vectors = decision104Vectors.default;
        window.industrialVectors = industrialVectors.default;

        console.log('โ ุชู ุชุญููู ููุงุนุฏ ุงูุจูุงูุงุช');

        // === ุงููุฑุญูุฉ 2: ุชููุฆุฉ ุงูููููุงุช ===
        console.log('๐ง ุชููุฆุฉ ุงูููููุงุช ุงูุฃุณุงุณูุฉ...');
        
        const normalizer = new ArabicNormalizer();
        
        // ุงุณุชุฎุฏุงู VectorEngineV7 ุจุฏูุงู ูู VectorEngine
        const vectorEngine = new VectorEngineV7(normalizer);
        await vectorEngine.initialize(); // ุชููุฆุฉ ุงููููุฐุฌ
        
        const intentClassifier = new IntentClassifier(normalizer, vectorEngine);
        const dbManager = new IndexedDBManager();
        const learningSystem = new LearningSystem(dbManager, normalizer);
        const queryParser = new QueryParser(normalizer, intentClassifier);
        const responseGenerator = new ResponseGenerator();
        const voiceHandler = new VoiceHandler();
        const typewriter = new TypewriterEffect();
        
        console.log('โ ุชู ุชููุฆุฉ ุฌููุน ุงูููููุงุช');

        // === ุงููุฑุญูุฉ 3: ุชููุฆุฉ ุงูููุงุฉ ุงูุฑุฆูุณูุฉ ===
        console.log('๐ง ุชููุฆุฉ ุงูููุงุฉ ุงูุฑุฆูุณูุฉ...');
        
        const aiCore = new AIExpertCore();
        aiCore.normalizer = normalizer;
        aiCore.vectorEngine = vectorEngine;
        aiCore.intentClassifier = intentClassifier;
        aiCore.dbManager = dbManager;
        aiCore.learningSystem = learningSystem;
        aiCore.queryParser = queryParser;
        
        aiCore.vectorDatabases = {
          activity: window.activityVectors,
          decision104: window.decision104Vectors,
          industrial: window.industrialVectors
        };
        
        await aiCore.initialize();
        console.log('โ ุงูููุงุฉ ุงูุฑุฆูุณูุฉ ุฌุงูุฒุฉ');

        // === ุงููุฑุญูุฉ 4: ุชููุฆุฉ ุงููุงุฌูุฉ ===
        console.log('๐จ ุชููุฆุฉ ูุงุฌูุฉ ุงููุณุชุฎุฏู...');
        
        const uiController = new UIController(
          aiCore,
          voiceHandler,
          typewriter,
          responseGenerator
        );
        
        await uiController.initialize();
        console.log('โ ุงููุงุฌูุฉ ุฌุงูุฒุฉ');

        // === ุญูุธ ูู window ===
        window.aiAssistant = {
          core: aiCore,
          ui: uiController,
          voice: voiceHandler,
          typewriter: typewriter,
          vectorEngine: vectorEngine,
          stats: () => {
            console.log('๐ ุฅุญุตุงุฆูุงุช ุงููุธุงู:');
            console.log('   - ุฅุญุตุงุฆูุงุช AI:', aiCore.getStatistics());
            console.log('   - ุฅุญุตุงุฆูุงุช ุงููุชุฌูุงุช:', vectorEngine.getStatistics());
            console.log('   - ุฅุญุตุงุฆูุงุช ุงูุชุนูู:', learningSystem.getStatistics());
          }
        };

        // ุฅุฎูุงุก ุดุงุดุฉ ุงูุชุญููู
        document.getElementById('loading-screen').style.display = 'none';

        console.log('');
        console.log('๐ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ');
        console.log('โ ุงููุณุงุนุฏ ุงูุฐูู ุฌุงูุฒ ููุนูู!');
        console.log('๐ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ');
        console.log('');
        console.log('๐ก ููููู ุงูุขู:');
        console.log('   โข ุงูุถุบุท ุนูู ุงูุฃููููุฉ ุงูุนุงุฆูุฉ ูุจุฏุก ุงููุญุงุฏุซุฉ');
        console.log('   โข ุงุณุชุฎุฏุงู ุงููุงูู ููุชุญุฏุซ ูุจุงุดุฑุฉ');
        console.log('   โข ุงููุชุงุจุฉ ูู ุญูู ุงููุต');
        console.log('');
        console.log('๐ ููุญุตูู ุนูู ุงูุฅุญุตุงุฆูุงุชุ ุงูุชุจ: aiAssistant.stats()');
        console.log('');

      } catch (error) {
        console.error('โ ูุดู ุชุญููู ุงููุธุงู:', error);
        // ูุนุงูุฌุฉ ุงูุฎุทุฃ
      }
    }

    // ุจุฏุก ุชุญููู ุงูุณูุฑูุจุชุงุช
    loadAll();
  </script>
</body>
</html>
